!function(a){var b={support:{pjax:window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/(iPod|iPhone|iPad|WebApps\/.+CFNetwork)/),storage:!!window.localStorage},toInt:function(a){return parseInt(a)},stack:{},getTime:function(){return 1*new Date},getRealUrl:function(a){return a=(a||"").replace(/\#.*?$/,""),a=a.replace("?pjax=true&","?").replace("?pjax=true","").replace("&pjax=true","")},getUrlHash:function(a){return a.replace(/^[^\#]*(?:\#(.*?))?$/,"$1")},getLocalKey:function(a){var b="pjax_"+encodeURIComponent(a);return{data:b+"_data",time:b+"_time",title:b+"_title"}},removeAllCache:function(){if(b.support.storage)for(var a in localStorage)"pjax"===(a.split("_")||[""])[0]&&delete localStorage[a]},getCache:function(a,c,d){var e,f,g,h;if(c=b.toInt(c),a in b.stack){if(e=b.stack[a],ctime=b.getTime(),e.time+1e3*c>ctime)return e;delete b.stack[a]}else if(d&&b.support.storage){var i=b.getLocalKey(a);if(f=i.data,g=i.time,e=localStorage.getItem(f)){if(h=b.toInt(localStorage.getItem(g)),h+1e3*c>b.getTime())return{data:e,title:localStorage.getItem(i.title)};localStorage.removeItem(f),localStorage.removeItem(g),localStorage.removeItem(i.title)}}return null},setCache:function(a,c,d,e){var g,f=b.getTime();b.stack[a]={data:c,title:d,time:f},e&&b.support.storage&&(g=b.getLocalKey(a),localStorage.setItem(g.data,c),localStorage.setItem(g.time,f),localStorage.setItem(g.title,d))},removeCache:function(a){if(a=b.getRealUrl(a||location.href),delete b.stack[a],b.support.storage){var c=b.getLocalKey(a);localStorage.removeItem(c.data),localStorage.removeItem(c.time),localStorage.removeItem(c.title)}}},c=function(d){if(d=a.extend({selector:"",container:"",callback:function(){},filter:function(){}},d),!d.container||!d.selector)throw new Error("selector & container options must be set");a("body").delegate(d.selector,"click",function(e){if(e.which>1||e.metaKey)return!0;var f=a(this),g=f.attr("href");if("function"==typeof d.filter&&d.filter.call(this,g,this)===!0)return!0;if(g===location.href)return!0;if(b.getRealUrl(g)==b.getRealUrl(location.href)){var h=b.getUrlHash(g);return h&&(location.hash=h,d.callback&&d.callback.call(this,{type:"hash"})),!0}e.preventDefault(),d=a.extend(!0,d,{url:g,element:this,title:"",push:!0}),c.request(d)})};c.xhr=null,c.options={},c.state={},c.defaultOptions={timeout:2e3,element:null,cache:86400,storage:!0,url:"",push:!0,show:"",title:"",titleSuffix:"",type:"GET",data:{pjax:!0},dataType:"html",callback:null,beforeSend:function(b){a(c.options.container).trigger("pjax.start",[b,c.options]),b&&b.setRequestHeader("X-PJAX",!0)},error:function(){c.options.callback&&c.options.callback.call(c.options.element,{type:"error"}),location.href=c.options.url},complete:function(b){a(c.options.container).trigger("pjax.end",[b,c.options])}},c.showFx={_default:function(a,b,c){this.html(a),b&&b.call(this,a,c)},fade:function(a,b,c){var d=this;c?(d.html(a),b&&b.call(d,a,c)):this.fadeOut(500,function(){d.html(a).fadeIn(500,function(){b&&b.call(d,a,c)})})}},c.showFn=function(b,d,e,f,g){var h=null;"function"==typeof b?h=b:(b in c.showFx||(b="_default"),h=c.showFx[b]),h&&h.call(d,e,function(){var b=location.hash;""!=b?(location.href=b,/Firefox/.test(navigator.userAgent)&&history.replaceState(a.extend({},c.state,{url:null}),document.title)):window.scrollTo(0,0),f&&f.call(this,e,g)},g)},c.success=function(d,e){if(e!==!0&&(e=!1),c.html&&(d=a(d).find(c.html).html()),-1!=(d||"").indexOf("<html"))return c.options.callback&&c.options.callback.call(c.options.element,{type:"error"}),location.href=c.options.url,!1;var g,f=c.options.title||"";c.options.element&&(g=a(c.options.element),f=g.attr("title")||g.text());var h=d.match(/<title>(.*?)<\/title>/);h&&(f=h[1]),f&&-1==f.indexOf(c.options.titleSuffix)&&(f+=c.options.titleSuffix),document.title=f,c.state={container:c.options.container,timeout:c.options.timeout,cache:c.options.cache,storage:c.options.storage,show:c.options.show,title:f,url:c.options.oldUrl};var i=a.param(c.options.data);""!=i&&(c.state.url=c.options.url+(/\?/.test(c.options.url)?"&":"?")+i),c.options.push?(c.active||(history.replaceState(a.extend({},c.state,{url:null}),document.title),c.active=!0),history.pushState(c.state,document.title,c.options.oldUrl)):c.options.push===!1&&history.replaceState(c.state,document.title,c.options.oldUrl),c.options.showFn&&c.options.showFn(d,function(){c.options.callback&&c.options.callback.call(c.options.element,{type:e?"cache":"success"})},e),c.options.cache&&!e&&b.setCache(c.options.url,d,f,c.options.storage)},c.request=function(d){d=a.extend(!0,c.defaultOptions,d);var e,f=a(d.container);return d.oldUrl=d.url,d.url=b.getRealUrl(d.url),a(d.element).length&&(e=b.toInt(a(d.element).attr("data-pjax-cache")),e&&(d.cache=e)),d.cache===!0&&(d.cache=86400),d.cache=b.toInt(d.cache),0===d.cache&&b.removeAllCache(),d.showFn||(d.showFn=function(a,b,e){c.showFn(d.show,f,a,b,e)}),c.options=d,c.options.success=c.success,d.cache&&(e=b.getCache(d.url,d.cache,d.storage))?(d.beforeSend(),d.title=e.title,c.success(e.data,!0),d.complete(),!0):(c.xhr&&c.xhr.readyState<4&&(c.xhr.onreadystatechange=a.noop,c.xhr.abort()),c.xhr=a.ajax(c.options),void 0)};var d="state"in window.history,e=location.href;a(window).bind("popstate",function(b){var f=!d&&location.href==e;if(d=!0,!f){var g=b.state;if(g&&g.container)if(a(g.container).length){var h={url:g.url,container:g.container,push:null,timeout:g.timeout,cache:g.cache,storage:g.storage,title:g.title,element:null};c.request(h)}else window.location=location.href}}),b.support.pjax||(c=function(){return!0},c.request=function(a){a&&a.url&&(location.href=a.url)}),a.pjax=c,a.pjax.util=b,a.inArray("state",a.event.props)<0&&a.event.props.push("state")}(jQuery);